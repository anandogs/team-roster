<!-- Roster Table Component -->
<div
    x-data="{
        searchQuery: '',
        editingEmployee: null,
        tempFte: null,

        init() {
            // Listen for employee updates
            window.addEventListener('employees-updated', () => {
                this.filterEmployees();
            });
        },

        get isLoading() {
            return $store.employees.loading;
        },

        get filteredEmployees() {
            const roster = [...$store.employees.rosterEmployees, ...$store.employees.newHires];
            if (!this.searchQuery) return roster;
            
            const query = this.searchQuery.toLowerCase();
            return roster.filter(emp => {
                const searchStr = `${emp.name} ${emp.band} ${emp.customer || 'New Hire'}`.toLowerCase();
                return searchStr.includes(query);
            });
        },

        startEdit(employee) {
            this.editingEmployee = employee.id;
            this.tempFte = employee.fte || employee.fteQuarter || 0;
        },

        saveFteEdit(employee) {
            if (this.tempFte < 0 || this.tempFte > 1) {
                return;
            }

            const index = $store.employees.rosterEmployees.findIndex(emp => emp.id === employee.id);
            if (index !== -1) {
                $store.employees.rosterEmployees[index] = {
                    ...$store.employees.rosterEmployees[index],
                    fte: parseFloat(this.tempFte)
                };
                $store.employees.notifyStateChange();
            }

            this.editingEmployee = null;
            this.tempFte = null;
        },

        removeEmployee(employee) {
            if (!confirm(`Are you sure you want to remove ${employee.name} from the roster?`)) {
                return;
            }

            if (employee.id.startsWith('newhire')) {
                $store.employees.newHires = $store.employees.newHires.filter(emp => emp.id !== employee.id);
            } else {
                $store.employees.removeFromRoster(employee.id);
            }
        }
    }"
    class="space-y-4"
>
    <!-- Loading State -->
    <template x-if="isLoading">
        <div class="text-center py-8">
            <div class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500 mx-auto"></div>
            <p class="mt-4 text-neutral-400">Loading roster data...</p>
        </div>
    </template>

    <!-- Roster Table -->
    <template x-if="!isLoading">
        <div>
            <!-- Search Input -->
            <div class="relative">
                <svg class="absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-neutral-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                </svg>
                <input
                    type="text"
                    x-model="searchQuery"
                    placeholder="Search employees..."
                    class="w-full pl-10 px-3 py-2 bg-neutral-800 border border-neutral-700 rounded-lg text-white placeholder-neutral-400 focus:outline-none focus:ring-2 focus:ring-blue-500"
                >
            </div>

            <div class="mt-4 rounded-md border border-neutral-800 overflow-x-auto">
                <table class="w-full">
                    <thead class="bg-neutral-800">
                        <tr>
                            <th class="px-4 py-3 text-left text-sm font-medium text-neutral-300">Name</th>
                            <th class="px-4 py-3 text-left text-sm font-medium text-neutral-300">Band</th>
                            <th class="px-4 py-3 text-left text-sm font-medium text-neutral-300">Customer</th>
                            <th class="px-4 py-3 text-left text-sm font-medium text-neutral-300">BU</th>
                            <th class="px-4 py-3 text-left text-sm font-medium text-neutral-300">Location</th>
                            <th class="px-4 py-3 text-left text-sm font-medium text-neutral-300">Billable</th>
                            <th class="px-4 py-3 text-left text-sm font-medium text-neutral-300">FTE</th>
                            <th class="px-4 py-3 text-right text-sm font-medium text-neutral-300">Actions</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-neutral-800">
                        <template x-if="filteredEmployees.length === 0">
                            <tr>
                                <td colspan="8" class="px-4 py-8 text-center text-neutral-500">
                                    <span x-text="searchQuery ? 'No matching employees found.' : 'No employees in roster yet.'"></span>
                                </td>
                            </tr>
                        </template>
                        <template x-for="employee in filteredEmployees" :key="employee.id">
                            <tr class="border-neutral-800">
                                <td class="px-4 py-3 whitespace-nowrap" x-text="employee.name"></td>
                                <td class="px-4 py-3 whitespace-nowrap" x-text="employee.band"></td>
                                <td class="px-4 py-3 whitespace-nowrap" x-text="employee.customer || 'New Hire'"></td>
                                <td class="px-4 py-3 whitespace-nowrap" x-text="employee.businessUnit || '-'"></td>
                                <td class="px-4 py-3 whitespace-nowrap" x-text="employee.location"></td>
                                <td class="px-4 py-3 whitespace-nowrap" x-text="employee.isBillable ? 'Yes' : 'No'"></td>
                                <td class="px-4 py-3">
                                    <template x-if="editingEmployee === employee.id">
                                        <input
                                            type="number"
                                            x-model="tempFte"
                                            step="0.1"
                                            min="0"
                                            max="1"
                                            class="w-20 px-2 py-1 bg-neutral-800 border border-neutral-700 rounded text-white text-sm"
                                        >
                                    </template>
                                    <template x-if="editingEmployee !== employee.id">
                                        <span x-text="(employee.fte || employee.fteQuarter || 0).toFixed(2)"></span>
                                    </template>
                                </td>
                                <td class="px-4 py-3 text-right space-x-1">
                                    <template x-if="editingEmployee === employee.id">
                                        <button
                                            @click="saveFteEdit(employee)"
                                            class="inline-flex items-center justify-center p-1 rounded-md hover:bg-neutral-700"
                                            title="Save"
                                        >
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                            </svg>
                                        </button>
                                    </template>
                                    <template x-if="editingEmployee !== employee.id">
                                        <button
                                            @click="startEdit(employee)"
                                            class="inline-flex items-center justify-center p-1 rounded-md hover:bg-neutral-700"
                                            title="Edit"
                                        >
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                            </svg>
                                        </button>
                                    </template>
                                    <button
                                        @click="removeEmployee(employee)"
                                        class="inline-flex items-center justify-center p-1 rounded-md hover:bg-neutral-700"
                                        title="Remove from roster"
                                    >
                                        <svg class="w-4 h-4 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                        </svg>
                                    </button>
                                </td>
                            </tr>
                        </template>
                    </tbody>
                </table>
            </div>
        </div>
    </template>
</div> 